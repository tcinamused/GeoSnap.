<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>GeoSnap</title>

<style>
body {
    background:#e6e6e6;
    font-family:Arial, sans-serif;
}
.phone {
    width:360px;
    height:640px;
    background:white;
    margin:40px auto;
    border-radius:25px;
    box-shadow:0 10px 30px rgba(0,0,0,.2);
    padding:20px;
}
.screen { display:none; text-align:center; }
.screen.active { display:block; }
button {
    width:100%;
    padding:12px;
    margin:8px 0;
    border:none;
    border-radius:10px;
    background:#4CAF50;
    color:white;
    font-size:16px;
}
button.secondary {
    background:#ccc;
    color:black;
}
.balance {
    background:#f2f2f2;
    padding:10px;
    border-radius:10px;
    margin-bottom:10px;
    font-weight:bold;
}
.inventory {
    font-size:14px;
    text-align:left;
    margin:10px;
}
#reader { width:100%; }
</style>
</head>

<body>

<div class="phone">

<!-- Splash -->
<div id="splash" class="screen active">
    <h1>GeoSnap</h1>
    <p>Laden...</p>
</div>

<!-- Home -->
<div id="home" class="screen">
    <h2>Home</h2>
    <div class="balance">ğŸ’° Munten: <span id="coins">0</span></div>
    <div class="inventory" id="inventory"></div>
    <button onclick="goTo('shop')">ğŸ›’ Shop</button>
    <button onclick="openQR()">ğŸ“· QR scannen</button>
</div>

<!-- Shop -->
<div id="shop" class="screen">
    <h2>Shop</h2>
    <p id="shopMessage"></p>

    <button onclick="buyItem('Ijsje',540)">ğŸ¦ Ijsje â€“ 540 munten</button>
    <button onclick="buyItem('Frietjes',1000)">ğŸŸ Frietjes â€“ 1000 munten</button>
    <button onclick="buyItem('Lolly',150)">ğŸ­ Lolly â€“ 150 munten</button>
    <button onclick="buyItem('Twix',250)">ğŸ« Twix â€“ 250 munten</button>

    <button class="secondary" onclick="goTo('home')">Terug</button>
</div>

<!-- QR -->
<div id="qr" class="screen">
    <h2>Scan QR-code</h2>
    <div id="reader"></div>
    <button class="secondary" onclick="stopQR()">Stop</button>
</div>

<!-- Result -->
<div id="result" class="screen">
    <h2 id="resultTitle"></h2>
    <p id="resultText"></p>
    <button onclick="goTo('home')">Terug naar home</button>
</div>

</div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
let coins = Number(localStorage.getItem("coins")) || 0;
let inventory = JSON.parse(localStorage.getItem("inventory")) || {
    Ijsje:0, Frietjes:0, Lolly:0, Twix:0
};
let lastPurchaseDate = localStorage.getItem("lastPurchaseDate") || "";
let qrScanner;

// Navigation
function goTo(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    updateUI();
}

// Splash â†’ Home
setTimeout(() => goTo('home'), 2000);

// UI update + opslag
function updateUI() {
    document.getElementById("coins").textContent = coins;
    document.getElementById("inventory").innerHTML =
        `ğŸ¦ Ijsjes: ${inventory.Ijsje}<br>
         ğŸŸ Frietjes: ${inventory.Frietjes}<br>
         ğŸ­ Lollyâ€™s: ${inventory.Lolly}<br>
         ğŸ« Twix: ${inventory.Twix}`;

    localStorage.setItem("coins", coins);
    localStorage.setItem("inventory", JSON.stringify(inventory));
    localStorage.setItem("lastPurchaseDate", lastPurchaseDate);
}

// QR
function openQR() {
    goTo('qr');
    qrScanner = new Html5Qrcode("reader");
    qrScanner.start(
        { facingMode:"environment" },
        { fps:10, qrbox:250 },
        onScanSuccess
    );
}

function stopQR() {
    if (qrScanner) qrScanner.stop();
    goTo('home');
}

function onScanSuccess() {
    qrScanner.stop();
    const gewonnen = Math.random() > 0.3;

    if (gewonnen) {
        const winst = Math.floor(Math.random()*300)+100;
        coins += winst;
        resultTitle.textContent = "ğŸ‰ Gewonnen!";
        resultText.textContent = "Je kreeg " + winst + " munten!";
    } else {
        resultTitle.textContent = "ğŸ˜¢ Helaas";
        resultText.textContent = "Geen munten gewonnen";
    }
    goTo('result');
}

// Shop â€“ max 1 aankoop per dag
function buyItem(item, price) {
    const today = new Date().toDateString();
    const msg = document.getElementById("shopMessage");

    if (lastPurchaseDate === today) {
        msg.textContent = "âŒ Maximaal 1 aankoop per dag";
        return;
    }

    if (coins >= price) {
        coins -= price;
        inventory[item]++;
        lastPurchaseDate = today;
        msg.textContent = "âœ… Aankoop gelukt!";
        updateUI();
    } else {
        msg.textContent = "âŒ Te weinig munten";
    }
}
</script>

</body>
</html>
